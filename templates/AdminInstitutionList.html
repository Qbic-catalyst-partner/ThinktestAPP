<!-- AdminInstitutionList.html -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Institution List</title>
  <!-- Tailwind CDN and font config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../static/css/index.css" />
  <link rel="stylesheet" href="https://unpkg.com/@material-tailwind/html@latest/styles/material-tailwind.css" />
  <link href="https://cdn.jsdelivr.net/npm/flowbite@2.4.1/dist/flowbite.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>

<body class="font-[Inter] bg-gray-50">
  <div class="flex flex-row h-screen w-full">
    {% include 'AdminSideNavBar.html' %}

    <section id="main-content"
      class="flex-1 overflow-auto p-4 transition-all duration-300 ease-in-out text-gray-700 body-font mt-16">
      <div class="flex flex-col justify-around">
        <div class="w-full container py-2 bg-gradient-to-r from-cyan-500">
          <p class="ml-16 text-white font-medium text-lg">List Of Institutions</p>
        </div>

        <div class="flex justify-end mt-8">
          <a href="{{ url_for('addInstitution') }}">
            <button class="bg-gray-400 text-white px-4 py-2 rounded">Add Institution</button>
          </a>
        </div>

        <form method="get" id="filterForm">
          <div class="flex flex-wrap gap-4 justify-start mt-8">
            <select name="search_institution" class="px-3 py-2 border border-gray-300 rounded-md w-[15.33%] h-12 text-sm">
              <option value="">Search By Institution</option>
              {% for institution in institution_names %}
              <option value="{{ institution.id }}" {% if current_filters.search_institution==institution.id|string %}selected{% endif %}>{{ institution.name }}</option>
              {% endfor %}
            </select>

            <!-- <select name="plan" class="px-3 py-2 border border-gray-300 rounded-md w-[15.33%] h-12 text-sm">
              <option value="">Plan</option>
              {% for plan in plan_options %}
              <option value="{{ plan }}" {% if current_filters.plan==plan %}selected{% endif %}>{{ plan }}</option>
              {% endfor %}
            </select> -->

            <select name="no_of_students" class="px-3 py-2 border border-gray-300 rounded-md w-[15.33%] h-12 text-sm">
              <option value="">Number of Students</option>
              <option value="1-10">1-10</option>
              <option value="11-50">11-50</option>
              <option value="51+">51+</option>
            </select>

            <select name="status" class="px-3 py-2 border border-gray-300 rounded-md w-[15.33%] h-12 text-sm">
              <option value="">Status</option>
              <option value="Active" {% if current_filters.status=='Active' %}selected{% endif %}>Active</option>
              <option value="Inactive" {% if current_filters.status=='Inactive' %}selected{% endif %}>Inactive</option>
            </select>

            <input type="date" name="enrol_from" value="{{ current_filters.enrol_from }}" class="px-3 py-2 border border-gray-300 rounded-md w-[15.33%] h-12 text-sm" />
            <input type="date" name="enrol_to" value="{{ current_filters.enrol_to }}" class="px-3 py-2 border border-gray-300 rounded-md w-[15.33%] h-12 text-sm" />
          </div>
        </form>

        <div class="mt-8" id="institution-table-wrapper">
          {% include 'AdminInstitutionPartial.html' %}
        </div>
      </div>
    </section>
  </div>

  <script>
    document.getElementById('filterForm').addEventListener('change', function () {
      const params = new URLSearchParams(new FormData(this)).toString();
      fetch(`/AdminInstitutionPartial?${params}`)
        .then(res => res.text())
        .then(html => {
          document.getElementById('institution-table-wrapper').innerHTML = html;
        });
    });

    // function openEditModal(id) {
    //   fetch(`/getInstitution?institution_id=${id}`)
    //     .then(res => res.json())
    //     .then(data => {
    //       if (!data.success) return alert(data.message);
    //       document.getElementById('edit_id').value = data.institution_id;
    //       document.getElementById('edit_institute_name').value = data.institute_name;
    //       document.getElementById('edit_no_of_students').value = data.no_of_students;
    //       document.getElementById('edit_contact').value = data.contact_no;
    //       document.getElementById('edit_email').value = data.email;
    //       document.getElementById('edit_address').value = data.address;
    //       document.getElementById('edit_description').value = data.description;
    //       document.getElementById('edit_plan').value = data.plan;
    //       document.getElementById('edit_status').value = data.status;
    //     });
    // }

    function deleteInstitution(id) {
      if (confirm("Are you sure you want to delete this institution?")) {
        fetch(`/deleteInstitution/${id}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ institution_id: id })
        })
          .then(res => res.json())
          .then(data => {
            if (data.success) location.reload();
            else alert(data.message || 'Delete failed');
          });
      }
    }
  </script>
</body>

</html>