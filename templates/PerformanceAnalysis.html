<!-- PerformanceAnalysisDashboard.html -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Analysis</title>
    <!-- Tailwind CDN and font config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../static/css/index.css" />
    <!-- Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="https://unpkg.com/@material-tailwind/html@latest/styles/material-tailwind.css" />
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.4.1/dist/flowbite.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css" rel="stylesheet" />
    <!-- script -->
    <link rel="stylesheet" href="https://unpkg.com/@material-tailwind/html@latest/styles/material-tailwind.css" />
    <script src="https://unpkg.com/@material-tailwind/html@latest/scripts/script-name.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>
<style>
    [data-accordion-target][aria-expanded="true"] {
        background-color: var(--links-color);
        color: white;
    }

    body,
    .font-sans {
        font-family: 'Inter', sans-serif !important;
    }
</style>

<body class="font-[Inter] bg-gray-50">

    <div class="flex flex-row h-screen w-[100vw]">
        <!-- Navbar section -->

        {% include 'InstitutionSideNavBar.html' %}

        <section id="main-content"
            class="flex-1 overflow-auto p-4 transition-all duration-300 ease-in-out text-gray-700 body-font mt-16">
            <div class="flex flex-col">
                <!-- Header Section -->
                <div class="container py-2 bg-gradient-to-r from-cyan-500">
                    <p class="ml-16 text-white font-medium text-lg">Performance Analysis</p>
                </div>

                <!-- Control bar -->
                <div class="container flex justify-around items-center gap-6 mt-8 border-gray-200">
                    <!-- Student dropdown -->
                    <form method="POST" action="/PerformanceAnalysis" id="student-filter-form"
                        class="flex items-center gap-2">
                        <label for="student-select" class="text-gray-700 font-medium">Filter By Student:</label>
                        <select name="student_id" id="student-select" class="border border-gray-300 rounded px-4 py-2"
                            onchange="document.getElementById('student-filter-form').submit();">
                            {% for id, fname, lname in students %}
                            <option value="{{ id }}" {% if id|string==selected_student_id|string %}selected{% endif %}>
                                {{ fname }} {{ lname }}
                            </option>
                            {% endfor %}
                        </select>
                    </form>

                    <!-- Tets Info checkbox -->
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="toggleDetails" class="accent-cyan-500 w-5 h-5">
                        <label for="toggleDetails" class="text-gray-700 font-medium">Include Test Information</label>
                    </div>
                </div>


                <!-- Mock Test Content Section -->

                <!-- Header Section -->
                <div class="container mt-8 py-2 rounded-lg bg-gray-400">
                    <p class="ml-16 text-white font-medium text-lg">Mock Test</p>
                </div>

                <!-- Statistics Section -->
                <div class="container pt-8 pb-2">
                    <div class="flex flex-wrap text-left justify-center md:justify-between">
                        <!-- Tile 1 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{mocks_completed}}</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Tests Completed</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/TestsCompleted.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 2 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{exams_targeted}}</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Exams Targeted</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/ExamsTargeted.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 3 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{average_score}}%</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Average Score</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/AvgScore.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 4 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{average_accuracy}}%
                                    </h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Average Accuracy</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/AvgAccuracy.svg') }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="w-full container pt-8 p-4">
                    <div id="charts-container" class="flex flex-wrap justify-evenly gap-x-2 gap-y-8">
                        <!-- PIE CHART -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Exams Attempted</h5>
                            <div id="mock-pie-chart" class="chart-container"></div>
                        </div>
                        <!-- BAR CHART -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Average Score by Subject</h5>
                            <div class="overflow-x-auto">
                                <div id="mock-column-chart" class=""></div>
                            </div>
                        </div>
                        <!-- LINE CHART  -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Average Score by Difficulty Level</h5>
                            <div id="mock-line-chart" class="chart-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Accordion Section -->

                <div class="detailsDiv" style="display:none;">
                    <!-- Filters -->
                    <div class="container pt-8 p-4">
                        <h1 class="font-bold text-gray-600 mb-4">Filter By:</h1>
                        <form action="/pa_filter_mocktest"
                            class="pa-filter-form flex flex-wrap gap-4 items-center w-full sm:w-auto">
                            <input type="hidden" name="student_id" value="{{ selected_student_id }}">

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Status</label>
                                <select name="status"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All</option>
                                    <option value="completed">Completed</option>
                                    <option value="partially_completed">Partially Completed</option>
                                </select>
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Exam</label>
                                <select name="exam"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All Exams</option>
                                    {% for exam_id, exam_name in unique_exams.items() %}
                                    <option value="{{ exam_id }}">{{ exam_name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">From Date</label>
                                <input type="date" name="from_date"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500" />
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">To Date</label>
                                <input type="date" name="to_date"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500" />
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Difficulty Level</label>
                                <select name="difficulty"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All</option>
                                    <option value="easy">Easy</option>
                                    <option value="medium">Medium</option>
                                    <option value="difficult">Difficult</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    {% include 'PAMockAccordion.html' %}
                </div>

                <!-- Daily Practice Section -->

                <!-- Header Section -->
                <div class="container mt-8 py-2 rounded-lg bg-gray-400">
                    <p class="ml-16 text-white font-medium text-lg">Daily Practice</p>
                </div>

                <!-- Statistics Section -->
                <div class="container pt-8 pb-2">
                    <div class="flex flex-wrap text-left justify-center md:justify-between">
                        <!-- Tile 1 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{(dp_attempt_details_completed|default([])|length)}}</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Tests Completed</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/TestsCompleted.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 2 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{modules_attempted_count}}</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Modules Attempted</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/ExamsTargeted.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 3 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">{{average}}%
                                    </h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Average Score</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/AvgScore.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 4 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">{{accuracy}}%
                                    </h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Average Accuracy</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/AvgAccuracy.svg') }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="w-full container pt-8 p-4">
                    <div id="charts-container" class="flex flex-wrap justify-evenly gap-x-2 gap-y-8">
                        <!-- PIE CHART -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Subjects Attempted</h5>
                            <div id="daily-pie-chart" class="chart-container"></div>
                        </div>
                        <!-- BAR CHART -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Average Score by Subject</h5>
                            <div class="overflow-x-auto">
                                <div id="daily-column-chart" class=""></div>
                            </div>
                        </div>
                        <!-- LINE CHART  -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Average Score by Difficulty Level</h5>
                            <div id="daily-line-chart" class="chart-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Accordion Section -->

                <div class="detailsDiv" style="display:none;">
                    <!-- Filters -->
                    <div class="container pt-8 p-4">
                        <h1 class="font-bold text-gray-600 mb-4">Filter By:</h1>
                        <form action="/pa_filter_dp"
                            class="pa-filter-form flex flex-wrap gap-4 items-center w-full sm:w-auto">
                            <input type="hidden" name="student_id" value="{{ selected_student_id }}">

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Status</label>
                                <select name="status"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All</option>
                                    <option value="completed">Completed</option>
                                    <option value="partially_completed">Partially Completed</option>
                                    <option value="lapsed">Lapsed</option>
                                </select>
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Subject</label>
                                <select name="subject"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All Subjects</option>
                                    {% for subject in subjects %}
                                    <option value="{{ subject.subject_name }}">{{subject.subject_name}}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">From Date</label>
                                <input type="date" name="from_date"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500" />
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">To Date</label>
                                <input type="date" name="to_date"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500" />
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Difficulty Level</label>
                                <select name="difficulty"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All</option>
                                    <option value="1">Beginner</option>
                                    <option value="2">Intermediate</option>
                                    <option value="3">Proficient</option>
                                    <option value="4">Advanced</option>
                                    <option value="5">Expert</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    {% include 'PADailyAccordion.html' %}
                </div>

                <!-- Custom section -->

                <!-- Header Section -->
                <div class="container mt-8 py-2 rounded-lg bg-gray-400">
                    <p class="ml-16 text-white font-medium text-lg">Custom Modules</p>
                </div>

                <!-- Statistics Section -->
                <div class="container pt-8 pb-2">
                    <div class="flex flex-wrap text-left justify-center md:justify-between">
                        <!-- Tile 1 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{(custom_attempt_details_completed|default([])|length)}}</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Tests Completed</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/TestsCompleted.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 2 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{custom_modules_attempted_count}}</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Modules Attempted</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/ExamsTargeted.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 3 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{custom_average}}%</h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Average Score</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/AvgScore.svg') }}">
                                </div>
                            </div>
                        </div>

                        <!-- Tile 4 -->
                        <div class="p-4 w-full md:w-1/4">
                            <div class="p-2 flex items-center justify-around h-full rounded-lg bg-white"
                                style="box-shadow: 0px 0px 4px 0px #00000040; min-height: 16vh;">
                                <div>
                                    <h2 class="title-font font-semibold text-xl xl:text-2xl text-gray-600">
                                        {{custom_accuracy}}%
                                    </h2>
                                    <p class="font-medium pb-4" style="color: var(--links-color);">Average Accuracy</p>
                                </div>
                                <div>
                                    <img class="w-[50px] h-[50px]"
                                        src="{{ url_for('static', filename='../static/images/DashTiles/AvgAccuracy.svg') }}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="w-full container pt-8 p-4">
                    <div id="charts-container" class="flex flex-wrap justify-evenly gap-x-2 gap-y-8">
                        <!-- PIE CHART -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Subjects Attempted</h5>
                            <div id="custom-pie-chart" class="chart-container"></div>
                        </div>
                        <!-- BAR CHART -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Average Score by Subject</h5>
                            <div class="overflow-x-auto">
                                <div id="custom-column-chart" class=""></div>
                            </div>
                        </div>
                        <!-- LINE CHART  -->
                        <div class="bg-white rounded-lg shadow p-4 md:p-6 text-center min-w-[300px] flex-1">
                            <h5 class="mb-8 font-bold text-gray-600">Average Score by Difficulty Level</h5>
                            <div id="custom-line-chart" class="chart-container"></div>
                        </div>
                    </div>
                </div>

                <!-- Accordion Section -->

                <div class="detailsDiv" style="display:none;">
                    <!-- Filters -->
                    <div class="container pt-8 p-4">
                        <h1 class="font-bold text-gray-600 mb-4">Filter By:</h1>
                        <form action="/pa_filter_custommodule"
                            class="pa-filter-form flex flex-wrap gap-4 items-center w-full sm:w-auto">
                            <input type="hidden" name="student_id" value="{{ selected_student_id }}">

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Status</label>
                                <select name="status"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All</option>
                                    <option value="completed">Completed</option>
                                    <option value="partially_completed">Partially Completed</option>
                                </select>
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Subject</label>
                                <select name="subject"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All Subjects</option>
                                    {% for subject in custom_subjects %}
                                    <option value="{{ subject.subject_name }}">{{subject.subject_name}}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">From Date</label>
                                <input type="date" name="from_date"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500" />
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">To Date</label>
                                <input type="date" name="to_date"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500" />
                            </div>

                            <div class="w-72 min-w-[200px]">
                                <label class="block text-sm text-gray-600 mb-1">Difficulty Level</label>
                                <select name="difficulty"
                                    class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
                                    <option value="all">All</option>
                                    <option value="1">Beginner</option>
                                    <option value="2">Intermediate</option>
                                    <option value="3">Proficient</option>
                                    <option value="4">Advanced</option>
                                    <option value="5">Expert</option>
                                </select>
                            </div>
                        </form>
                    </div>
                    {% include 'PACustomAccordion.html' %}
                </div>

            </div>
        </section>
    </div>
    </div>



    <script>
        const fetchPieChartData = async (charttype) => {
            try {
                if (charttype == "mock")
                    response = await fetch('/PieChartData');
                else if (charttype == "daily")
                    response = await fetch('/DailyPracticePieChartData');
                else
                    response = await fetch('/CustomModulePieChartData');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                // console.error("Error fetching exam data:", error);
                return { labels: [], series: [] }; // Fallback for errors
            }
        };

        const getPieChartOptions = async (charttype) => {
            const pieChartData = await fetchPieChartData(charttype);
            return {
                series: pieChartData.series,

                colors: ["#FB9251", "#0ABDDB", "#F2BC2A", "#AA47BC", "#00ACC1", "#E91E63", "#9C27B0", "#3F51B5", "#4CAF50", "#FF9800", "#795548", "#607D8B"],
                chart: {
                    // height: "100%",
                    type: "pie",
                },
                stroke: {
                    colors: ["white"],
                    lineCap: "",
                },
                plotOptions: {
                    pie: {
                        labels: {
                            show: true,
                        },
                        dataLabels: {
                            offset: -25
                        }
                    },
                },
                labels: pieChartData.labels,
                dataLabels: {
                    enabled: true,
                    style: {
                        fontFamily: "Inter, sans-serif",
                    },
                },
                legend: {
                    show: true,
                    position: "bottom",
                    fontFamily: "Inter, sans-serif"
                },
            }
        }

        if (document.getElementById("mock-pie-chart") && document.getElementById("daily-pie-chart") && document.getElementById("custom-pie-chart") && typeof ApexCharts !== 'undefined') {
            getPieChartOptions("mock")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("mock-pie-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the mock pie chart:", error);
                });
            getPieChartOptions("daily")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("daily-pie-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the daily pie chart:", error);
                });
            getPieChartOptions("custom")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("custom-pie-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the custom pie chart:", error);
                });
        }

        const fetchBarChartData = async (charttype) => {
            try {
                if (charttype == "mock")
                    response = await fetch('/BarChartData');
                else if (charttype == "daily")
                    response = await fetch('/DailyPracticeBarChartData');
                else
                    response = await fetch('/CustomModuleBarChartData');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                // console.error("Error fetching bar chart data:", error);
                return { series: {} }; // Fallback for errors
            }
        };

        const getBarChartOptions = async (charttype) => {
            const barChartData = await fetchBarChartData(charttype);
            // console.log("Bar Chart Data:", barChartData.series);
            const numBars = barChartData.series[0].data.length;
            const chartWidth = numBars * (30);
            const chartElementId = `${charttype}-column-chart`;
            document.getElementById(chartElementId).style.minWidth = `${chartWidth}px`;

            return {
                series: barChartData.series,
                chart: {
                    type: "bar",
                    height: "300px",
                    fontFamily: "Inter, sans-serif",
                    toolbar: {
                        show: false,
                    },
                },
                legend: {
                    show: false
                },
                plotOptions: {
                    bar: {
                        borderRadius: 5,
                        borderRadiusApplication: "top",
                        horizontal: false,
                        columnWidth: "15px",
                    },
                },
                tooltip: {
                    shared: true,
                    intersect: false,
                    style: {
                        fontFamily: "Inter, sans-serif",
                    },
                },
                states: {
                    hover: {
                        filter: {
                            type: "darken",
                            value: 0.85,
                        },
                    },
                },
                stroke: {
                    show: true,
                    width: 1,
                    colors: ["transparent"],
                },
                grid: {
                    show: true,
                    strokeDashArray: 4,
                },
                dataLabels: {
                    enabled: false,
                },
                xaxis: {
                    labels: {
                        show: true,
                        style: {
                            fontFamily: "Inter, sans-serif",
                            cssClass: "text-xs font-normal fill-gray-500 dark:fill-gray-400",
                        },
                    },
                    axisBorder: {
                        show: true, // Show x-axis border
                        color: "#E0E0E0",
                    },
                    axisTicks: {
                        show: true, // Show x-axis ticks
                        color: "#E0E0E0",
                    },
                },
                yaxis: {
                    show: true, // Show y-axis
                    labels: {
                        style: {
                            fontFamily: "Inter, sans-serif",
                        },
                        formatter: function (value) {
                            return value.toFixed(0); // Format to 2 decimal points
                        },
                    },
                    axisBorder: {
                        show: true, // Show y-axis border
                        color: "#E0E0E0",
                    },
                    axisTicks: {
                        show: true, // Show y-axis ticks
                        color: "#E0E0E0",
                    },
                },
                fill: {
                    type: "gradient", // Enable gradient fill
                    gradient: {
                        shade: "light",
                        type: "vertical",
                        shadeIntensity: 0.5,
                        gradientToColors: ["#D3D3D3"], // Gradient endpoint color
                        inverseColors: false,
                        stops: [0, 100], // Control gradient positions
                    },
                },
                colors: ["#00C6FB"]
            };
        };

        if (document.getElementById("mock-column-chart") && document.getElementById("daily-column-chart") && document.getElementById("custom-column-chart") && typeof ApexCharts !== 'undefined') {
            getBarChartOptions("mock")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("mock-column-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the bar chart:", error);
                });
            getBarChartOptions("daily")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("daily-column-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the bar chart:", error);
                });
            getBarChartOptions("custom")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("custom-column-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the bar chart:", error);
                });
        }

        const fetchLineChartData = async (charttype) => {
            try {
                if (charttype == "mock")
                    response = await fetch('/LineChartData');
                else if (charttype == "daily")
                    response = await fetch('/DailyPracticeLineChartData');
                else
                    response = await fetch('/CustomModuleLineChartData');
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                // console.error("Error fetching line chart data:", error);
                return { labels: [], series: [] }; // Fallback for errors
            }
        };

        const getLineChartOptions = async (charttype) => {
            const lineChartData = await fetchLineChartData(charttype);

            return {
                chart: {
                    type: "line",
                    height: "300px",
                    fontFamily: "Inter, sans-serif",
                    dropShadow: {
                        enabled: false,
                    },
                    toolbar: {
                        show: false,
                    },
                },
                tooltip: {
                    enabled: true,
                    x: {
                        show: false,
                    },
                },
                dataLabels: {
                    enabled: false,
                },
                stroke: {
                    curve: "smooth",
                    width: 4, // Adjust line thickness
                },
                grid: {
                    show: true,
                    strokeDashArray: 4,
                },
                series: lineChartData.series,
                legend: {
                    show: true,
                    position: "bottom", // Position legend above the chart
                    fontFamily: "Inter, sans-serif",
                },
                xaxis: {
                    categories: lineChartData.labels,
                    labels: {
                        show: true,
                        style: {
                            fontFamily: "Inter, sans-serif",
                            cssClass: "text-xs font-normal fill-gray-500 dark:fill-gray-400",
                        },
                    },
                    axisBorder: {
                        show: true, // Show x-axis border
                        color: "#E0E0E0",
                    },
                    axisTicks: {
                        show: true, // Show x-axis ticks
                        color: "#E0E0E0",
                    },
                },
                yaxis: {
                    show: true, // Show y-axis
                    labels: {
                        style: {
                            fontFamily: "Inter, sans-serif",
                        },
                        formatter: function (value) {
                            return value.toFixed(0); // Format to 2 decimal points
                        },
                    },
                    axisBorder: {
                        show: true, // Show y-axis border
                        color: "#E0E0E0",
                    },
                    axisTicks: {
                        show: true, // Show y-axis ticks
                        color: "#E0E0E0",
                    },
                },
            }
        };

        if (document.getElementById("mock-line-chart") && document.getElementById("daily-line-chart") && document.getElementById("custom-line-chart") && typeof ApexCharts !== 'undefined') {
            getLineChartOptions("mock")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("mock-line-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the line chart:", error);
                });
            getLineChartOptions("daily")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("daily-line-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the line chart:", error);
                });
            getLineChartOptions("custom")
                .then((options) => {
                    const chart = new ApexCharts(document.getElementById("custom-line-chart"), options);
                    chart.render();
                })
                .catch((error) => {
                    // console.error("Error initializing the line chart:", error);
                });
        }

        function initializeAccordion() {
            const accordions = document.querySelectorAll('[data-accordion="collapse"]');
            accordions.forEach(accordion => {
                const buttons = accordion.querySelectorAll('[data-accordion-target]');
                buttons.forEach(button => {
                    button.addEventListener('click', function () {
                        const target = document.querySelector(this.getAttribute('data-accordion-target'));
                        if (target) {
                            target.classList.toggle('hidden');

                            const isExpanded = button.getAttribute('aria-expanded') === 'true';
                            button.setAttribute('aria-expanded', !isExpanded);
                        }
                    });
                });
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            initializeAccordion();
        });

        // const filterForm = document.getElementById('filter-form');
        const accordionContainer = document.getElementById('accordion-container');

        // filterForm.addEventListener('change', () => {
        //     const formData = new FormData(filterForm);
        //     fetch('/filter_mocktest', {
        //         method: 'POST',
        //         body: formData,
        //     })
        //         .then(response => {
        //             if (!response.ok) {
        //                 throw new Error(`HTTP error! status: ${response.status}`);
        //             }
        //             return response.text(); // Expecting the server to return HTML content
        //         })
        //         .then(html => {
        //             accordionContainer.innerHTML = html;
        //             initializeAccordion();
        //             bindViewReportButtons();
        //         })
        //         .catch(error => // console.error('Error:', error));
        // });

        document.querySelectorAll('.pa-filter-form').forEach(form => {
            form.addEventListener('change', () => {
                const formData = new FormData(form);
                const actionUrl = form.getAttribute('action');

                fetch(actionUrl, {
                    method: 'POST',
                    body: formData,
                })
                    .then(response => {
                        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                        return response.text();
                    })
                    .then(html => {
                        // Find the nearest .detailsDiv to this form and replace its accordion
                        const detailsDiv = form.closest('.detailsDiv');
                        const accordionContainer = detailsDiv.querySelector('#accordion-container');
                        accordionContainer.innerHTML = html;
                        initializeAccordion();
                    })
            });
        });

        document.getElementById("toggleDetails").addEventListener("change", function () {
            const allDetails = document.querySelectorAll('.detailsDiv');
            const show = this.checked;

            allDetails.forEach(div => {
                div.classList.toggle('hidden', !show);
                div.style.display = show ? 'block' : 'none';
            });
        });

    </script>

</body>

</html>