<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Report</title>
  <!-- Tailwind CSS -->
  <!-- Tailwind CDN and font config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                },
            },
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
  <link rel="stylesheet" href="../static/css/index.css" />
  <!-- Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- DaisyUI -->
  <!-- <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" /> -->

</head>
<style>
  .custom-shadow-report {
    border-radius: 1px;
    box-shadow: 0px 0px 4px 0px #00000040;
  }

  @media print {
    .radial-progress {
      background: conic-gradient(var(--progress-color, #0EC1DD) calc(var(--value, 0) * 1%),
          #f3f4f6 0);
      position: relative;
    }

    .radial-progress span {
      display: block;
      text-align: center;
      position: absolute;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
    }
  }

  .radial-progress {
    position: relative;
    display: inline-grid;
    height: var(--size);
    width: var(--size);
    place-content: center;
    border-radius: 9999px;
    background-color: transparent;
    vertical-align: middle;
    background-color: rgb(248, 247, 247);
    color: var(--links-color);
    box-sizing: content-box;
    --value: 0;
    --size: 5rem;
    --thickness: calc(var(--size) / 10)
  }

  .radial-progress::-moz-progress-bar {
    appearance: none;
    background-color: transparent
  }

  .radial-progress::-webkit-progress-value {
    appearance: none;
    background-color: transparent
  }

  .radial-progress::-webkit-progress-bar {
    appearance: none;
    background-color: transparent
  }

  .radial-progress:after,
  .radial-progress:before {
    position: absolute;
    border-radius: 9999px;
    content: ""
  }

  .radial-progress:before {
    inset: 0px;
    background: radial-gradient(farthest-side, currentColor 98%, #02cefc00) top/var(--thickness) var(--thickness) no-repeat, conic-gradient(currentColor calc(var(--value) * 1%), #0000 0);
    mask: radial-gradient(farthest-side, #0000 calc(99% - var(--thickness)), #000 calc(100% - var(--thickness)))
  }

  .radial-progress:after {
    inset: calc(50% - var(--thickness)/ 2);
    transform: rotate(calc(var(--value) * 3.6deg - 90deg)) translate(calc(var(--size)/ 2 - 50%));
    background-color: currentColor
  }
body,
    .font-sans {
        font-family: 'Inter', sans-serif !important;
    }
</style>

<body class="font-[Inter] bg-gray-50">
  <nav class="bg-white custom-shadow-report px-20 py-4" onclick="window.location.href='/MockTestDashboard'">
    <div class="flex items-center">
      <img src="{{ url_for('static', filename='images/logo.svg') }}" alt="Brand Logo"
        class="w-[120px] sm:w-[150px] h-auto cursor-pointer">
    </div>
  </nav>

  <div class="px-20 py-4">

    <!-- Greetings -->
    <div class="mt-4 text-gray-600" id="tophead">
      <h1 class="pb-2 text-xl font-semibold" style="color:var(--links-color);">Hey {{student_name}},</h1>
      <h2 class="text-l">This is your Mock Analysis for <span class="font-semibold"
          style="color:var(--links-color);">{{exam_name}}</span> </h2>
    </div>

    <!-- Statistics Tiles Section -->
    <div class="flex flex-row gap-12 mt-12">
      <div class="flex custom-shadow-report p-8 justify-center items-center">
        <div class="radial-progress"
          style="--value: {{ all_sections['Percentage'] | default(0) }}; --size: 10rem; --thickness: 10px;"
          role="progressbar">
          <span class="text-gray-700 text-center text-xl font-semibold">
            <span class="text-2xl font-medium">Percentage</span>
            <br>
            {{all_sections['Percentage']}}%
          </span>
        </div>
      </div>
      <div class="w-[60vw] lg:w-[80vw] flex flex-col gap-4 justify-between items-center">
        <div class="p-4 custom-shadow-report w-full">
          <div class="flex gap-4 justify-center">
            {% if all_sections['Percentage'] > 90 %}
            <img src="../static/images/avatars/Awesome.svg" alt="" width="50" height="30">

            {% elif all_sections['Percentage'] > 80 and all_sections['Percentage'] <= 90 %} <img
              src="../static/images/avatars/GreatWork.svg" alt="" width="50" height="30">

              {% elif all_sections['Percentage'] > 70 and all_sections['Percentage'] <= 80 %} <img
                src="../static/images/avatars/AlmostThere.svg" alt="" width="50" height="30">

                {% elif all_sections['Percentage'] > 60 and all_sections['Percentage'] <= 70 %} <img
                  src="../static/images/avatars/MuchBetter.svg" alt="" width="50" height="30">

                  {% else %}
                  <img src="../static/images/avatars/MuchBetter.svg" alt="" width="50" height="30">

                  {% endif %}

                  <div class="flex flex-col justify-center">

                    {% if all_sections['Percentage'] > 90 %}

                    <h1 class="text-xl text-blue-600" style="color:var(--links-color);">Awesome, {{student_name}}!</h1>

                    {% elif all_sections['Percentage'] > 80 and all_sections['Percentage'] <= 90 %} <h1
                      class="text-xl text-blue-600" style="color:var(--links-color);">Great Work, {{student_name}}!
                      </h1>

                      {% elif all_sections['Percentage'] > 70 and all_sections['Percentage'] <= 80 %} <h1
                        class="text-xl text-blue-600" style="color:var(--links-color);">You are almost there,
                        {{student_name}}!</h1>

                        {% elif all_sections['Percentage'] > 60 and all_sections['Percentage'] <= 70 %} <h1
                          class="text-xl text-blue-600" style="color:var(--links-color);">You can do much better,
                          {{student_name}}!</h1>

                          {% else %}
                          <h1 class="text-xl text-blue-600" style="color:var(--links-color);">You can do much better,
                            {{student_name}}!</h1>

                          {% endif %}
                          <!-- <p class="font-medium text-gray-600 text-xl mt-2">To improve your score please check the
                            recommendations.</p> -->
                  </div>
          </div>
        </div>
        <div
          class="p-4 custom-shadow-report w-full flex items-center justify-around space-x-8 overflow-x-auto whitespace-nowrap">
          {% for subject in subjects %}
          <div class="flex items-center space-x-4 inline-block">
            <!-- <div class=""> -->
            <div class="radial-progress" style="--value: {{ subject.percentage }}; " role="progressbar">
              <span class="text-black font-semibold">{{ subject.percentage }}%</span>
            </div>
            <!-- </div> -->
            <div>
              <div class="text-lg text-gray-600">{{ subject.subject_name }}</div>
              <div class="text-lg font-bold text-gray-800">{{ subject.score }}</div>
              <div class="text-s text-gray-600">Your Score</div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Report table summary -->
    <div class="mt-12">
      <table class="w-full border-separate" style="border-spacing: 0 15px;">
        <thead class="border border-gray-300 border-b-2 text-gray-600" style="box-shadow: 0px 0px 4px 0px #00000040;">
          <tr>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-left">Name</th>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Questions</th>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Attempted</th>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Correct</th>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Incorrect</th>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Skipped</th>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Score</th>
            <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Percentage</th>
            <!-- <th class="py-2 px-4 border-b-2 border-gray-300 text-center">Avg Time Spent</th> -->
          </tr>
        </thead>
        <tbody>
          <tr class="bg-[#F0F4F9]">
            <td class="py-2 px-4 border-b border-gray-300">All Sections</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Total_Questions'] }}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Total_Attempted']}}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Correct']}}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Incorrect']}}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Skipped']}}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Score']}}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Percentage']}}%</td>
            <!-- <td class="py-2 px-4 border-b border-gray-300 text-center">{{all_sections['Total_Time_Spent']}}</td> -->
          </tr>
          {% for subject in subjects %}
          <tr class="border border-gray-300 border-b">
            <td class="py-2 px-4 border-b border-gray-300">{{ subject.subject_name }}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{subject.question_count}}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{ subject.attempted }}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{ subject.correct }}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{ subject.incorrect }}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{ subject.skipped }}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{ subject.score }}</td>
            <td class="py-2 px-4 border-b border-gray-300 text-center">{{ subject.percentage }}%</td>
            <!-- <td class="py-2 px-4 border-b border-gray-300 text-center">{{ subject.total_time_spent }}</td> -->
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <div class="px-20 py-4">
    <div class="flex justify-between">
      <h1 class="text-xl font-semibold" style="color: var(--links-color);">Solution in Detail</h1>
      <form id="filter-report-form" action="/filter_report" method="POST"
        class="flex flex-wrap gap-4 items-center w-full sm:w-auto">
        <input type="hidden" name="attempt_id" value="{{ attempt_id }}">
        <input type="hidden" name="total_questions" value="{{all_sections['Total_Questions'] }}">
        <div class="w-72 min-w-[200px]">
          <label class="block text-sm text-gray-600 mb-1">Subject</label>
          <select name="subjects"
            class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
            <option value="all">All Subjects</option>
            {% for subject in subjects %}
            <option value="{{ subject.subject_name }}">{{ subject.subject_name }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="w-72 min-w-[200px]">
          <label class="block text-sm text-gray-600 mb-1">Response Type</label>
          <select name="responsetype"
            class="h-full w-full rounded-lg border border-gray-200 px-3 py-2.5 text-sm focus:ring-cyan-500 focus:border-cyan-500">
            <option value="all">All Responses</option>
            <option value="correct">Correct</option>
            <option value="incorrect">Incorrect</option>
            <option value="skipped">Skipped</option>
          </select>
        </div>
      </form>

      <button class="font-bold text-center uppercase rounded-lg text-cyan-500 border border-cyan-500 p-4" id="download">
        <i class="fa-solid fa-download"></i>
        Download Report
      </button>
    </div>
  </div>

  <div id="report" class="px-20 py-4 w-full flex flex-col gap-6">
    {% include 'ReportSolution.html' %}
  </div>

  <script>
    window.onload = function () {
      document.getElementById("download").addEventListener("click", () => {
        window.print();
      })
    }

    document.addEventListener("DOMContentLoaded", function () {
      const filterForm = document.getElementById("filter-report-form");


      filterForm.querySelectorAll("select").forEach((dropdown) => {
        dropdown.addEventListener("change", () => {
          fetch(filterForm.action, {
            method: "POST",
            body: new FormData(filterForm),
          })
            .then((response) => {
              if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
              }
              return response.text();
            })
            .then((html) => {
              document.getElementById("report").innerHTML = html;
            })
            .catch((error) => {
              // console.error("Error submitting the form:", error);
            });
        });
      });
    });
  </script>

</body>

</html>